# -*- coding: utf-8 -*-
# -*- mode: org -*-
#+startup: beamer overview indent
#+LANGUAGE: pt-br
#+TAGS: noexport(n)
#+EXPORT_EXCLUDE_TAGS: noexport
#+EXPORT_SELECT_TAGS: export

#+Title: Comp. Syst. Perf. Analysis
#+SubTitle: Introduction to Simulation
#+Author: Prof. Lucas Mello Schnorr
#+Date: \copyleft

#+LaTeX_CLASS: beamer
#+LaTeX_CLASS_OPTIONS: [xcolor=dvipsnames,10pt]
#+OPTIONS: H:1 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t
#+LATEX_HEADER: \input{org-babel.tex}

* Introduction to Simulation

- Simulation is an important tool for performance analysis
  - When the real system is unavailable
  - Or when many workloads/environments must be tested
- Chosen during system design or procurement to compare alternatives
  - Simulation may offer broader exploration of scenarios

#+latex: \vfill\pause
  
- Despite its usefulness
  - Many simulation projects fail or produce misleading results
  - Failures often stem from imbalance
    - Strong software skills but weak statistics
    - Or strong statistics but weak software engineering

#+latex: \vfill\pause

- Large simulations frequently take far longer than expected
  - Many are abandoned before completion

#+latex: \vfill\pause

** Agenda                                                          :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:

- Common mistakes
- Terminology
- Types of simulations

* Mistake: Choosing an inappropriate level of detail (1/2)

Simulation can represent far more detail than analytical models

But excessive detail increases:
- Development time
- Likelihood of bugs
- Debugging effort
- Execution time (often hours or days in large models)

#+latex: \pause\vfill

More detail is not always better:
- Detailed models require detailed input data
- Missing or approximate inputs can make a detailed model *less* accurate

#+latex: \pause\vfill

** Example: Simulating disk service time                           :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
- Simple approach: exponential service-time distribution
- Detailed approach: simulate head movement and rotation

#+latex: \pause

- If sector/track references are unavailable, the detailed model may end up artificially generating random sector numbers and still producing exponential service timesâ€”but with much more complexity

* Mistake: Choosing an inappropriate level of detail (2/2)    

Detailed models also take significantly longer to build

#+latex: \vfill\pause

** Better approach                                                 :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
- Start with a simple model
- Obtain early results and analyze sensitivities
- Add detail only where it meaningfully impacts the results

#+latex: \vfill\pause

** Key idea                                                        :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:

Incremental refinement!
- Produces better, more reliable simulation models
  - Instead of all-at-once detailed modeling

* Mistake: Improper Programming Language Choice

The programming language strongly affects
- How quickly a simulation model can be developed
- How quickly a simulation can run

#+latex: \vfill\pause

Special-purpose simulation languages
- Reduce development time
- Simplify tasks
  - Verification using traces
  - Statistical analysis
  
General-purpose languages offer
- Greater portability and control over efficiency and runtime

#+latex: \vfill\pause

** Key ideia

Use modern programming languages
- Core: compilation based for faster simulation
- Ease: use API for scripting languages

* Mistakes: Unverified and Invalid Models

Situations that may arise with unverified models
- Bugs or programming errors that render conclusions meaningless
- Large simulation programs with excess of extrapolation studies
- Error-free code can still be invalid
  - When assumptions about system behavior are incorrect

#+latex: \vfill\pause

** Key ideia: _validation_ is essential                            :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
Results should align against
- Analytical models (the idea)
- Measurements (the reality)
- Domain intuition (the feeling)

#+latex: \vfill\pause

Simulation outputs must always be treated with suspicion
- Until independently verified and confirmed

* Mistake: Too Short Simulations

Short simulations produce results
- Dominated by initial conditions rather than steady-state behavior
  - Misleading performance estimates and unreliable conclusions

- Required simulation length depends on
  - Desired accuracy and
  - The variance of observed metrics

- Simple stats fail because simulation outputs are often correlated over time

#+latex: \pause

** Key ideia                                                       :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:

Proper techniques include
- Warm-up removal + Batching + Ensuring adequate observation periods

#+latex: \pause\vfill

** How batching works                                              :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:

Run one long simulation after warm-up
1. Divide the output time-series into k contiguous batches of equal length.
2. Compute the average of each batch.
3. Treat these batch means as approximately independent observations.

#+latex: \pause

Use these means to compute:
- Overall estimates (e.g., system delay) + Confidence intervals

* Mistake: Poor random-number generators and seed selection

Poor Random-Number Generators
- Using weak or homemade generators can introduce bias
  - Rely on well-tested, validated RNGs from trusted libraries

#+latex: \vfill\pause

Improper Selection of Seeds
- Reusing or poorly choosing seeds creates correlated streams
- Assign distinct, well-spaced seeds to ensure independent random behavior

* Terminology 1/2

- _State variables_ and _Events_

#+latex: \vfill\pause

- Continuous-Time Models
  - State is defined at every instant
  - Example: CPU scheduling
- Discrete-Time Models
  - State defined only at specific times
  - Example: class attendance known on Friday

#+latex: \vfill\pause

- Continuous-State Models
  - State variables take uncountably infinite values
  - Example: time spend studying
- Discrete-State Models (also called discrete-event models)
  - State variables take discrete values
  - Example: number of students or CPU queue length

#+latex: \vfill\pause

#+begin_center
Continuity of time does not imply continuity of state and vice versa

All four possible combinations.
#+end_center

* Terminology 2/2
- Deterministic vs Probabilistic
  - Deterministic gives identical outputs
  - Probabilistic yields different outputs for same inputs
#+latex: \vfill\pause
- Static vs Dynamic
  - Static models ignore time
  - Dynamic models include time and evolving state
#+latex: \vfill\pause
- Linear vs Nonlinear
  - Outputs are linear functions of inputs vs
  - Nonlinear relationships
#+latex: \vfill\pause    
- Open vs Closed Models
  - Open models receive external independent input
  - Closed models circulate jobs internally
* Types of Simulations 1/2

There are four types
1. Emulation
2. Monte Carlo
3. Trace-driven
4. Discrete-event

#+latex: \vfill\pause

** Emulation                                                       :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
- Hardware/firmware mimics another system
- Mostly hardware design issues

#+latex: \vfill\pause

** Monte Carlo                                                     :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
- Static, no time axis
- Models probabilistic phenomena using pseudo-random numbers
  - Also used to estimate nonprobabilistic expressions

* Types of Simulations 1/2

** Trace-Driven                                                    :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
- Uses real-system traces as input
  - Ideal for analyzing paging, caches, CPU scheduling, deadlock prevention, storage allocation
- Trace Caveat
  - Trace must be independent of the system studied
  - e.g., page-fetch traces depend on replacement policy and cannot be
    used to study other page replacement policies \to one would need a
    trace of pages referenced
- Time-Independent Traces

** Discrete-Event                                                  :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
- Uses discrete-state models
- Time may be discrete or continuous

* References

#+latex: {\small
- Chapter 24. Jain, Raj. The art of computer systems performance
  analysis: techniques for experimental design, measurement,
  simulation, and modeling. New York: John Wiley,
  c1991. ISBN 0471503363
#+latex: }
